{"id":21228,"date":"2020-12-26T17:04:59","date_gmt":"2020-12-26T09:04:59","guid":{"rendered":"https:\/\/coolshell.cn\/?p=21228"},"modified":"2020-12-26T17:07:07","modified_gmt":"2020-12-26T09:07:07","slug":"go%e7%bc%96%e7%a8%8b%e6%a8%a1%e5%bc%8f%ef%bc%9apipeline","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/21228.html","title":{"rendered":"Go\u7f16\u7a0b\u6a21\u5f0f\uff1aPipeline"},"content":{"rendered":"<p><img decoding=\"async\" loading=\"lazy\" class=\"aligncenter wp-image-21258 size-large\" src=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.line_.-1024x191.png\" alt=\"\" width=\"640\" height=\"119\" srcset=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.line_.-1024x191.png 1024w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.line_.-300x56.png 300w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.line_.-768x143.png 768w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.line_.-1536x286.png 1536w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.line_.-604x113.png 604w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.line_..png 1920w\" sizes=\"(max-width: 640px) 100vw, 640px\" \/><\/p>\n<p>\u672c\u7bc7\u6587\u7ae0\uff0c\u6211\u4eec\u7740\u91cd\u4ecb\u7ecdGo\u7f16\u7a0b\u4e2d\u7684Pipeline\u6a21\u5f0f\u3002\u5bf9\u4e8ePipeline\u7528\u8fc7Unix\/Linux\u547d\u4ee4\u884c\u7684\u4eba\u90fd\u4e0d\u4f1a\u964c\u751f\uff0c\u4ed6\u662f\u4e00\u79cd\u628a\u5404\u79cd\u547d\u4ee4\u62fc\u63a5\u8d77\u6765\u5b8c\u6210\u4e00\u4e2a\u66f4\u5f3a\u529f\u80fd\u7684\u6280\u672f\u65b9\u6cd5\u3002\u5728\u4eca\u5929\uff0c\u6d41\u5f0f\u5904\u7406\uff0c\u51fd\u6570\u5f0f\u7f16\u7a0b\uff0c\u4ee5\u53ca\u5e94\u7528\u7f51\u5173\u5bf9\u5fae\u670d\u52a1\u8fdb\u884c\u7b80\u5355\u7684API\u7f16\u6392\uff0c\u5176\u5b9e\u90fd\u662f\u53d7pipeline\u8fd9\u79cd\u6280\u672f\u65b9\u5f0f\u7684\u5f71\u54cd\uff0cPipeline\u8fd9\u79cd\u6280\u672f\u5728\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u628a\u4ee3\u7801\u6309\u5355\u4e00\u804c\u8d23\u7684\u539f\u5219\u62c6\u5206\u6210\u591a\u4e2a\u9ad8\u5185\u805a\u4f4e\u8026\u5408\u7684\u5c0f\u6a21\u5757\uff0c\u7136\u540e\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u62fc\u88c5\u8d77\u6765\u53bb\u5b8c\u6210\u6bd4\u8f83\u590d\u6742\u7684\u529f\u80fd\u3002<\/p>\n<section class=\"post-series\"><h3 class=\"post-series-title\">\u672c\u6587\u662f\u5168\u7cfb\u5217\u4e2d\u7b2c8 \/ 10\u7bc7\uff1a<a href=\"https:\/\/coolshell.cn\/articles\/series\/go%e7%bc%96%e7%a8%8b%e6%a8%a1%e5%bc%8f\">Go\u7f16\u7a0b\u6a21\u5f0f<\/a><\/h3><ul class=\"post-series-list\"><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21128.html\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u5207\u7247\uff0c\u63a5\u53e3\uff0c\u65f6\u95f4\u548c\u6027\u80fd<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21140.html\">Go \u7f16\u7a0b\u6a21\u5f0f\uff1a\u9519\u8bef\u5904\u7406<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21146.html\">Go \u7f16\u7a0b\u6a21\u5f0f\uff1aFunctional Options<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21214.html\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u59d4\u6258\u548c\u53cd\u8f6c\u63a7\u5236<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21164.html\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1aMap-Reduce<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21179.html\">Go \u7f16\u7a0b\u6a21\u5f0f\uff1aGo Generation<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/17929.html\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u4fee\u9970\u5668<\/a><\/span><\/li><li class=\"post-series-item-current post-series-item\"><span class=\"post-series-item-title\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1aPipeline<\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21263.html\">Go \u7f16\u7a0b\u6a21\u5f0f\uff1ak8s Visitor \u6a21\u5f0f<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21615.html\">Go\u7f16\u7a0b\u6a21\u5f0f \uff1a \u6cdb\u578b\u7f16\u7a0b<\/a><\/span><\/li><\/ul><nav class=\"post-series-nav\"><span class=\"post-series-nav-prev\">&laquo; <a href=\"https:\/\/coolshell.cn\/articles\/17929.html\" rel=\"prev\" title=\"Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u4fee\u9970\u5668\">\u4e0a\u4e00\u7bc7\u6587\u7ae0<\/a><\/span><span class=\"post-series-nav-next\"><a href=\"https:\/\/coolshell.cn\/articles\/21263.html\" rel=\"next\" title=\"Go \u7f16\u7a0b\u6a21\u5f0f\uff1ak8s Visitor \u6a21\u5f0f\">\u4e0b\u4e00\u7bc7\u6587\u7ae0<\/a> &raquo;<\/span><\/nav><\/section>\n<div id=\"ez-toc-container\" class=\"ez-toc-v2_0_48 counter-hierarchy ez-toc-counter ez-toc-grey ez-toc-container-direction\">\n<div class=\"ez-toc-title-container\">\n<p class=\"ez-toc-title\">\u76ee\u5f55<\/p>\n<span class=\"ez-toc-title-toggle\"><\/span><\/div>\n<nav><ul class='ez-toc-list ez-toc-list-level-1 ' ><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-1\" href=\"https:\/\/coolshell.cn\/articles\/21228.html\/#HTTP_%E5%A4%84%E7%90%86\" title=\"HTTP \u5904\u7406\">HTTP \u5904\u7406<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-2\" href=\"https:\/\/coolshell.cn\/articles\/21228.html\/#Channel_%E7%AE%A1%E7%90%86\" title=\"Channel \u7ba1\u7406\">Channel \u7ba1\u7406<\/a><ul class='ez-toc-list-level-5'><li class='ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-3\" href=\"https:\/\/coolshell.cn\/articles\/21228.html\/#Channel%E8%BD%AC%E5%8F%91%E5%87%BD%E6%95%B0\" title=\"Channel\u8f6c\u53d1\u51fd\u6570\">Channel\u8f6c\u53d1\u51fd\u6570<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-4\" href=\"https:\/\/coolshell.cn\/articles\/21228.html\/#%E5%B9%B3%E6%96%B9%E5%87%BD%E6%95%B0\" title=\"\u5e73\u65b9\u51fd\u6570\">\u5e73\u65b9\u51fd\u6570<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-5\" href=\"https:\/\/coolshell.cn\/articles\/21228.html\/#%E8%BF%87%E6%BB%A4%E5%A5%87%E6%95%B0%E5%87%BD%E6%95%B0\" title=\"\u8fc7\u6ee4\u5947\u6570\u51fd\u6570\">\u8fc7\u6ee4\u5947\u6570\u51fd\u6570<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-6\" href=\"https:\/\/coolshell.cn\/articles\/21228.html\/#%E6%B1%82%E5%92%8C%E5%87%BD%E6%95%B0\" title=\"\u6c42\u548c\u51fd\u6570\">\u6c42\u548c\u51fd\u6570<\/a><\/li><\/ul><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-7\" href=\"https:\/\/coolshell.cn\/articles\/21228.html\/#Fan_inOut\" title=\"Fan in\/Out\">Fan in\/Out<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-8\" href=\"https:\/\/coolshell.cn\/articles\/21228.html\/#%E5%BB%B6%E4%BC%B8%E9%98%85%E8%AF%BB\" title=\"\u5ef6\u4f38\u9605\u8bfb\">\u5ef6\u4f38\u9605\u8bfb<\/a><\/li><\/ul><\/nav><\/div>\n<h4><span class=\"ez-toc-section\" id=\"HTTP_%E5%A4%84%E7%90%86\"><\/span>HTTP \u5904\u7406<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u8fd9\u79cdPipeline\u7684\u6a21\u5f0f\uff0c\u6211\u4eec\u5728\u300a<a title=\"Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u4fee\u9970\u5668\" href=\"https:\/\/coolshell.cn\/articles\/17929.html\" target=\"_blank\" rel=\"noopener\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u4fee\u9970\u5668<\/a>\u300b\u4e2d\u6709\u8fc7\u4e00\u4e2a\u793a\u4f8b\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u518d\u91cd\u6e29\u4e00\u4e0b\u3002\u5728\u90a3\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u6709\u4e00\u5806\u5982 <code>WithServerHead()<\/code> \u3001<code>WithBasicAuth()<\/code> \u3001<code>WithDebugLog()<\/code>\u8fd9\u6837\u7684\u5c0f\u529f\u80fd\u4ee3\u7801\uff0c\u5728\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u67d0\u4e2aHTTP API \u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u7ec4\u7ec7\u8d77\u6765\u3002<\/p>\n<p>\u539f\u6765\u7684\u4ee3\u7801\u662f\u4e0b\u9762\u8fd9\u4e2a\u6837\u5b50\uff1a<\/p>\n<p><!--more--><\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">http.HandleFunc(\"\/v1\/hello\", WithServerHeader(WithAuthCookie(hello)))\nhttp.HandleFunc(\"\/v2\/hello\", WithServerHeader(WithBasicAuth(hello)))\nhttp.HandleFunc(\"\/v3\/hello\", WithServerHeader(WithBasicAuth(WithDebugLog(hello))))<\/pre>\n<p>\u901a\u8fc7\u4e00\u4e2a\u4ee3\u7406\u51fd\u6570\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\">type HttpHandlerDecorator func(http.HandlerFunc) http.HandlerFunc\nfunc Handler(h http.HandlerFunc, decors ...HttpHandlerDecorator) http.HandlerFunc {\n    for i := range decors {\n        d := decors[len(decors)-1-i] \/\/ iterate in reverse\n        h = d(h)\n    }\n    return h\n}<\/pre>\n<p>\u6211\u4eec\u5c31\u53ef\u4ee5\u79fb\u9664\u4e0d\u65ad\u7684\u5d4c\u5957\u50cf\u4e0b\u9762\u8fd9\u6837\u4f7f\u7528\u4e86\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\">http.HandleFunc(\"\/v4\/hello\", Handler(hello,\n                WithServerHeader, WithBasicAuth, WithDebugLog))<\/pre>\n<h4><span class=\"ez-toc-section\" id=\"Channel_%E7%AE%A1%E7%90%86\"><\/span>Channel \u7ba1\u7406<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u5f53\u7136\uff0c\u5982\u679c\u4f60\u8981\u5199\u51fa\u4e00\u4e2a<a href=\"https:\/\/coolshell.cn\/articles\/17929.html#%E6%B3%9B%E5%9E%8B%E7%9A%84%E4%BF%AE%E9%A5%B0%E5%99%A8\" target=\"_blank\" rel=\"noopener\">\u6cdb\u578b\u7684pipeline\u6846\u67b6<\/a>\u5e76\u4e0d\u5bb9\u6613\uff0c\u800c\u4f7f\u7528<a title=\"GO \u7f16\u7a0b\u6a21\u5f0f\uff1aGo Generation\" href=\"https:\/\/coolshell.cn\/articles\/21179.html\" target=\"_blank\" rel=\"noopener\">Go Generation<\/a>\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u522b\u5fd8\u4e86Go\u8bed\u8a00\u6700\u5177\u7279\u8272\u7684 Go Routine \u548c Channel \u8fd9\u4e24\u4e2a\u795e\u5668\u5b8c\u5168\u4e5f\u53ef\u4ee5\u88ab\u6211\u4eec\u7528\u6765\u6784\u9020\u8fd9\u79cd\u7f16\u7a0b\u3002<\/p>\n<p>Rob Pike\u5728 <a href=\"https:\/\/blog.golang.org\/pipelines\" target=\"_blank\" rel=\"noopener\">Go Concurrency Patterns: Pipelines and cancellation<\/a> \u8fd9\u7bc7blog\u4e2d\u4ecb\u7ecd\u4e86\u5982\u4e0b\u7684\u4e00\u79cd\u7f16\u7a0b\u6a21\u5f0f\u3002<\/p>\n<h5><span class=\"ez-toc-section\" id=\"Channel%E8%BD%AC%E5%8F%91%E5%87%BD%E6%95%B0\"><\/span>Channel\u8f6c\u53d1\u51fd\u6570<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u9996\u5148\uff0c\u6211\u4eec\u9700\u4e00\u4e2a <code>echo()<\/code>\u51fd\u6570\uff0c\u5176\u4f1a\u628a\u4e00\u4e2a\u6574\u578b\u6570\u7ec4\u653e\u5230\u4e00\u4e2aChannel\u4e2d\uff0c\u5e76\u8fd4\u56de\u8fd9\u4e2aChannel<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">func echo(nums []int) &lt;-chan int {\n  out := make(chan int)\n  go func() {\n    for _, n := range nums {\n      out &lt;- n\n    }\n    close(out)\n  }()\n  return out\n}<\/pre>\n<p>\u7136\u540e\uff0c\u6211\u4eec\u4f9d\u7167\u8fd9\u4e2a\u6a21\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u4e0b\u8fd9\u4e2a\u51fd\u6570\u3002<\/p>\n<h5><span class=\"ez-toc-section\" id=\"%E5%B9%B3%E6%96%B9%E5%87%BD%E6%95%B0\"><\/span>\u5e73\u65b9\u51fd\u6570<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">func sq(in &lt;-chan int) &lt;-chan int {\n  out := make(chan int)\n  go func() {\n    for n := range in {\n      out &lt;- n * n\n    }\n    close(out)\n  }()\n  return out\n}\n<\/pre>\n<h5><span class=\"ez-toc-section\" id=\"%E8%BF%87%E6%BB%A4%E5%A5%87%E6%95%B0%E5%87%BD%E6%95%B0\"><\/span>\u8fc7\u6ee4\u5947\u6570\u51fd\u6570<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">func odd(in &lt;-chan int) &lt;-chan int {\n  out := make(chan int)\n  go func() {\n    for n := range in {\n      if n%2 != 0 {\n        out &lt;- n\n      }\n    }\n    close(out)\n  }()\n  return out\n}\n<\/pre>\n<h5><span class=\"ez-toc-section\" id=\"%E6%B1%82%E5%92%8C%E5%87%BD%E6%95%B0\"><\/span>\u6c42\u548c\u51fd\u6570<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">func sum(in &lt;-chan int) &lt;-chan int {\n  out := make(chan int)\n  go func() {\n    var sum = 0\n    for n := range in {\n      sum += n\n    }\n    out &lt;- sum\n    close(out)\n  }()\n  return out\n}<\/pre>\n<p>\u7136\u540e\uff0c\u6211\u4eec\u7684\u7528\u6237\u7aef\u7684\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a\uff08\u6ce8\uff1a<strong>\u4f60\u53ef\u80fd\u4f1a\u89c9\u5f97\uff0c<code>sum()<\/code>\uff0c<code>odd()<\/code> \u548c <code>sq()<\/code>\u592a\u8fc7\u4e8e\u76f8\u4f3c\u3002\u4f60\u5176\u5b9e\u53ef\u4ee5\u901a\u8fc7\u6211\u4eec\u4e4b\u524d\u7684<a href=\"https:\/\/coolshell.cn\/articles\/21164.html\" target=\"_blank\" rel=\"noopener\">Map\/Reduce\u7f16\u7a0b\u6a21\u5f0f<\/a>\u6216\u662f<a href=\"https:\/\/coolshell.cn\/articles\/21179.html\" target=\"_blank\" rel=\"noopener\">Go Generation\u7684\u65b9\u5f0f<\/a>\u6765\u5408\u5e76\u4e00\u4e0b<\/strong>\uff09<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">var nums = []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\nfor n := range sum(sq(odd(echo(nums)))) {\n  fmt.Println(n)\n}<\/pre>\n<p>\u4e0a\u9762\u7684\u4ee3\u7801\u7c7b\u4f3c\u4e8e\u6211\u4eec\u6267\u884c\u4e86Unix\/Linux\u547d\u4ee4\uff1a <code>echo $nums | sq | sum<\/code><\/p>\n<p>\u540c\u6837\uff0c\u5982\u679c\u4f60\u4e0d\u60f3\u6709\u90a3\u4e48\u591a\u7684\u51fd\u6570\u5d4c\u5957\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u4ee3\u7406\u51fd\u6570\u6765\u5b8c\u6210\u3002<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">type EchoFunc func ([]int) (&lt;- chan int) \ntype PipeFunc func (&lt;- chan int) (&lt;- chan int) \n\nfunc pipeline(nums []int, echo EchoFunc, pipeFns ... PipeFunc) &lt;- chan int {\n  ch  := echo(nums)\n  for i := range pipeFns {\n    ch = pipeFns[i](ch)\n  }\n  return ch\n}<\/pre>\n<p>\u7136\u540e\uff0c\u5c31\u53ef\u4ee5\u8fd9\u6837\u505a\u4e86\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">var nums = []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}    \nfor n := range pipeline(nums, gen, odd, sq, sum) {\n    fmt.Println(n)\n  }<\/pre>\n<h4><span class=\"ez-toc-section\" id=\"Fan_inOut\"><\/span>Fan in\/Out<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u52a8\u7528Go\u8bed\u8a00\u7684 Go Routine\u548c Channel\u8fd8\u6709\u4e00\u4e2a\u597d\u5904\uff0c\u5c31\u662f\u53ef\u4ee5\u5199\u51fa1\u5bf9\u591a\uff0c\u6216\u591a\u5bf91\u7684pipeline\uff0c\u4e5f\u5c31\u662fFan In\/ Fan Out\u3002\u4e0b\u9762\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e2aFan in\u7684\u793a\u4f8b\uff1a<\/p>\n<p>\u6211\u4eec\u60f3\u901a\u8fc7\u5e76\u53d1\u7684\u65b9\u5f0f\u6765\u5bf9\u4e00\u4e2a\u5f88\u957f\u7684\u6570\u7ec4\u4e2d\u7684\u8d28\u6570\u8fdb\u884c\u6c42\u548c\u8fd0\u7b97\uff0c\u6211\u4eec\u60f3\u5148\u628a\u6570\u7ec4\u5206\u6bb5\u6c42\u548c\uff0c\u7136\u540e\u518d\u628a\u5176\u96c6\u4e2d\u8d77\u6765\u3002<\/p>\n<p>\u4e0b\u9762\u662f\u6211\u4eec\u7684\u4e3b\u51fd\u6570\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">func makeRange(min, max int) []int {\n  a := make([]int, max-min+1)\n  for i := range a {\n    a[i] = min + i\n  }\n  return a\n}\n\nfunc main() {\n  nums := makeRange(1, 10000)\n  in := echo(nums)\n\n  const nProcess = 5\n  var chans [nProcess]&lt;-chan int\n  for i := range chans {\n    chans[i] = sum(prime(in))\n  }\n\n  for n := range sum(merge(chans[:])) {\n    fmt.Println(n)\n  }\n}<\/pre>\n<p>\u518d\u770b\u6211\u4eec\u7684 <code>prime()<\/code> \u51fd\u6570\u7684\u5b9e\u73b0 \uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">func is_prime(value int) bool {\n  for i := 2; i &lt;= int(math.Floor(float64(value) \/ 2)); i++ {\n    if value%i == 0 {\n      return false\n    }\n  }\n  return value &gt; 1\n}\n\nfunc prime(in &lt;-chan int) &lt;-chan int {\n  out := make(chan int)\n  go func ()  {\n    for n := range in {\n      if is_prime(n) {\n        out &lt;- n\n      }\n    }\n    close(out)\n  }()\n  return out\n}<\/pre>\n<p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c<\/p>\n<ul>\n<li>\u6211\u4eec\u5148\u5236\u9020\u4e86\u4ece1\u523010000\u7684\u4e00\u4e2a\u6570\u7ec4\uff0c<\/li>\n<li>\u7136\u540e\uff0c\u628a\u8fd9\u5806\u6570\u7ec4\u5168\u90e8 <code>echo<\/code>\u5230\u4e00\u4e2achannel\u91cc &#8211; <code>in<\/code><\/li>\n<li>\u6b64\u65f6\uff0c\u751f\u6210 5 \u4e2a Channel\uff0c\u7136\u540e\u90fd\u8c03\u7528 <code>sum(prime(in))<\/code> \uff0c\u4e8e\u662f\u6bcf\u4e2aSum\u7684Go Routine\u90fd\u4f1a\u5f00\u59cb\u8ba1\u7b97\u548c<\/li>\n<li>\u6700\u540e\u518d\u628a\u6240\u6709\u7684\u7ed3\u679c\u518d\u6c42\u548c\u62fc\u8d77\u6765\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u7ed3\u679c\u3002<\/li>\n<\/ul>\n<p>\u5176\u4e2d\u7684merge\u4ee3\u7801\u5982\u4e0b\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">func merge(cs []&lt;-chan int) &lt;-chan int {\n  var wg sync.WaitGroup\n  out := make(chan int)\n\n  wg.Add(len(cs))\n  for _, c := range cs {\n    go func(c &lt;-chan int) {\n      for n := range c {\n        out &lt;- n\n      }\n      wg.Done()\n    }(c)\n  }\n  go func() {\n    wg.Wait()\n    close(out)\n  }()\n  return out\n}<\/pre>\n<p>\u7528\u56fe\u7247\u8868\u793a\u4e00\u4e0b\uff0c\u6574\u4e2a\u7a0b\u5e8f\u7684\u7ed3\u6784\u5982\u4e0b\u6240\u793a\uff1a<\/p>\n<p><img decoding=\"async\" loading=\"lazy\" class=\"aligncenter size-large wp-image-21231\" src=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline-1024x425.png\" alt=\"\" width=\"640\" height=\"266\" srcset=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline-1024x425.png 1024w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline-300x124.png 300w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline-768x319.png 768w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline-1536x637.png 1536w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline-604x251.png 604w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline.png 1572w\" sizes=\"(max-width: 640px) 100vw, 640px\" \/><\/p>\n<h4><span class=\"ez-toc-section\" id=\"%E5%BB%B6%E4%BC%B8%E9%98%85%E8%AF%BB\"><\/span>\u5ef6\u4f38\u9605\u8bfb<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u5982\u679c\u4f60\u8fd8\u60f3\u4e86\u89e3\u66f4\u591a\u7684\u8fd9\u6837\u7684\u4e0e\u5e76\u53d1\u76f8\u5173\u7684\u6280\u672f\uff0c\u53ef\u4ee5\u53c2\u770b\u4e0b\u9762\u8fd9\u4e9b\u8d44\u6e90\uff1a<\/p>\n<ul>\n<li><b>Go<\/b> <b>Concurrency<\/b> <b>Patterns<\/b><b><\/b> &#8211; <b>Rob<\/b> <b>Pike &#8211;<\/b> 2012 Google I\/O\u00a0<b><br \/>\n<\/b>presents the basics of Go\u2018s concurrency primitives and several ways to apply them.<br \/>\n<u><a href=\"https:\/\/www.youtube.com\/watch?v=f6kdp27TYZs\">https:\/\/www.youtube.com\/watch?v=f6kdp27TYZs<\/a><\/u><\/li>\n<li><b>Advanced Go Concurrency Patterns\u00a0<\/b>&#8211; <b>Rob<\/b> <b>Pike<\/b> \u2013 2013 Google I\/O\u00a0<b><br \/>\n<\/b>covers more complex uses of Go&#8217;s primitives, especially\u00a0select.<br \/>\n<a href=\"https:\/\/blog.golang.org\/advanced-go-concurrency-patterns\">https:\/\/blog.golang.org\/advanced-go-concurrency-patterns<\/a><\/li>\n<li><b>Squinting at Power Series\u00a0<\/b>&#8211; <b>Douglas McIlroy<\/b>\u2018s paper\u00a0<b><br \/>\n<\/b>shows how Go-like concurrency provides elegant support for complex calculations.<br \/>\n<a href=\"https:\/\/swtch.com\/~rsc\/thread\/squint.pdf\">https:\/\/swtch.com\/~rsc\/thread\/squint.pdf<\/a><\/li>\n<\/ul>\n<p>\uff08\u5168\u6587\u5b8c\uff09<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>\u672c\u7bc7\u6587\u7ae0\uff0c\u6211\u4eec\u7740\u91cd\u4ecb\u7ecdGo\u7f16\u7a0b\u4e2d\u7684Pipeline\u6a21\u5f0f\u3002\u5bf9\u4e8ePipeline\u7528\u8fc7Unix\/Linux\u547d\u4ee4\u884c\u7684\u4eba\u90fd\u4e0d\u4f1a\u964c\u751f\uff0c\u4ed6\u662f\u4e00\u79cd\u628a\u5404\u79cd\u547d\u4ee4\u62fc\u63a5\u8d77\u6765\u5b8c\u6210\u4e00\u4e2a\u66f4\u5f3a&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/21228.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[819,23,3],"tags":[864,238,237,845],"series":[866],"aioseo_notices":[],"views":49814,"post_thumbnail_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline.png","content_first_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline.png","post_medium_image_300":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline.png","post_thumbnail_image_624":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline.png","post_frist_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline.png","post_medium_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline.png","post_large_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline.png","post_full_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline.png","post_all_images":[{"imagesurl":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.line_.-1024x191.png","id":"image0"},{"imagesurl":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/pipeline-1024x425.png","id":"image1"}],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":14,"category_name":"Go \u8bed\u8a00","post_date":"2020-12-26","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[],"pageviews":49815,"pageviews_wl":25686,"ratings_average":3,"ratings_total":149,"ratings_users":38,"next_post_id":21263,"next_post_title":"Go \u7f16\u7a0b\u6a21\u5f0f\uff1ak8s Visitor \u6a21\u5f0f","previous_post_id":21214,"previous_post_title":"Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u59d4\u6258\u548c\u53cd\u8f6c\u63a7\u5236"}